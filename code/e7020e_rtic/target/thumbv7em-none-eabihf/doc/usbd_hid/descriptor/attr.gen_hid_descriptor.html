<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Attribute to generate a HID descriptor &amp; serialization code"><meta name="keywords" content="rust, rustlang, rust-lang, gen_hid_descriptor"><title>gen_hid_descriptor in usbd_hid::descriptor - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc attr"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a class="sidebar-logo" href="../../usbd_hid/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.png" alt="logo"></div>
        </a><div class="sidebar-elems"><h2 class="location">Other items in<br><a href="../index.html">usbd_hid</a>::<wbr><a href="index.html">descriptor</a></h2><div id="sidebar-vars" data-name="gen_hid_descriptor" data-ty="attr" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../usbd_hid/index.html"><img class="rust-logo" src="../../rust-logo.png" alt="logo"></a><nav class="sub"><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><h1 class="fqn"><span class="in-band">Attribute Macro <a href="../index.html">usbd_hid</a>::<wbr><a href="index.html">descriptor</a>::<wbr><a class="attr" href="#">gen_hid_descriptor</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></span></h1><div class="docblock item-decl"><pre class="rust attr"><code>#[gen_hid_descriptor]</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Attribute to generate a HID descriptor &amp; serialization code</p>
<p>You are expected to provide two inputs to this generator:</p>
<ul>
<li>A struct of named fields (which follows the <code>gen_hid_descriptor</code> attribute)</li>
<li>A specially-formatted section describing the properties of the descriptor (this
section must be provided as arguments to the <code>gen_hid_descriptor()</code> attribute)</li>
</ul>
<p>The generated HID descriptor will be available as a <code>&amp;[u8]</code> by calling
<code>YourStructType::desc()</code>. <code>YourStructType</code> also now implements <code>SerializedDescriptor</code>.</p>
<p>As long as a descriptor describes only input or output types, and a report ID is
not used, the wire format for transmitting and recieving the data described by the
descriptor is simply the packed representation of the struct itself.
Where report ID’s are used anywhere in the descriptor, you must prepend the relevant
report ID to the packed representation of the struct prior to transmission.</p>
<p>If inputs and outputs are mixed within the same HID descriptor, then only the struct
fields used in that direction can be present in a payload being transmitted in that
direction.</p>
<p>If report ID’s are not used, input (device-to-host) serialization code is generated
automatically, and is represented by the implementation of the <code>AsInputReport</code> trait.</p>
<h2 id="examples" class="section-header"><a href="#examples">Examples</a></h2>
<ul>
<li>Custom 32-octet array, sent from device to host</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">gen_hid_descriptor</span>(
    (<span class="ident">collection</span> <span class="op">=</span> <span class="ident">APPLICATION</span>, <span class="ident">usage_page</span> <span class="op">=</span> <span class="ident">VENDOR_DEFINED_START</span>, <span class="ident">usage</span> <span class="op">=</span> <span class="number">0x01</span>) <span class="op">=</span> {
        <span class="ident">buff</span><span class="op">=</span><span class="ident">input</span>;
    }
)]</span>
<span class="kw">struct</span> <span class="ident">CustomInputReport</span> {
    <span class="ident">buff</span>: [<span class="ident">u8</span>; <span class="number">32</span>],
}</code></pre></div>
<ul>
<li>Custom input / output, sent in either direction</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">gen_hid_descriptor</span>(
    (<span class="ident">collection</span> <span class="op">=</span> <span class="ident">APPLICATION</span>, <span class="ident">usage_page</span> <span class="op">=</span> <span class="ident">VENDOR_DEFINED_START</span>, <span class="ident">usage</span> <span class="op">=</span> <span class="number">0x01</span>) <span class="op">=</span> {
        <span class="ident">input_buffer</span><span class="op">=</span><span class="ident">input</span>;
        <span class="ident">output_buffer</span><span class="op">=</span><span class="ident">output</span>;
    }
)]</span>
<span class="kw">struct</span> <span class="ident">CustomBidirectionalReport</span> {
    <span class="ident">input_buffer</span>: [<span class="ident">u8</span>; <span class="number">32</span>],
    <span class="ident">output_buffer</span>: [<span class="ident">u8</span>; <span class="number">32</span>],
}</code></pre></div>
<p>Because both inputs and outputs are used, the data format when sending / recieving is the
32 bytes in the relevant direction, <strong>NOT</strong> the full 64 bytes contained within the struct.</p>
<ul>
<li>Packed bitfields</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">gen_hid_descriptor</span>(
    (<span class="ident">report_id</span> <span class="op">=</span> <span class="number">0x01</span>,) <span class="op">=</span> {
        <span class="attribute">#[<span class="ident">packed_bits</span> <span class="number">3</span>]</span> <span class="ident">f1</span><span class="op">=</span><span class="ident">input</span>;
        <span class="attribute">#[<span class="ident">packed_bits</span> <span class="number">9</span>]</span> <span class="ident">f2</span><span class="op">=</span><span class="ident">input</span>;
    }
)]
<span class="kw">struct</span> <span class="ident">CustomPackedBits</span> {
    <span class="ident">f1</span>: <span class="ident">u8</span>,
    <span class="ident">f2</span>: <span class="ident">u16</span>,
}</code></pre></div>
<p>Because the <code>#[packed_bits]</code> sub-attribute was used, the two input fields specified are
interpreted as packed bits. As such, <code>f1</code> describes 3 boolean inputs, and <code>f2</code> describes
9 boolean inputs. Padding constants are automatically generated.</p>
<p>The <code>#[packed_bits &lt;num bits&gt;]</code> feature is intended to be used for describing button presses.</p>
<ul>
<li>Customizing the settings on a report item</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">gen_hid_descriptor</span>(
    (<span class="ident">collection</span> <span class="op">=</span> <span class="ident">APPLICATION</span>, <span class="ident">usage_page</span> <span class="op">=</span> <span class="ident">VENDOR_DEFINED_START</span>, <span class="ident">usage</span> <span class="op">=</span> <span class="number">0x01</span>) <span class="op">=</span> {
        (<span class="ident">usage_min</span> <span class="op">=</span> <span class="ident">X</span>, <span class="ident">usage_max</span> <span class="op">=</span> <span class="ident">Y</span>) <span class="op">=</span> {
            <span class="attribute">#[<span class="ident">item_settings</span> <span class="ident">data</span>,<span class="ident">variable</span>,<span class="ident">relative</span>]</span> <span class="ident">x</span><span class="op">=</span><span class="ident">input</span>;
            <span class="attribute">#[<span class="ident">item_settings</span> <span class="ident">data</span>,<span class="ident">variable</span>,<span class="ident">relative</span>]</span> <span class="ident">y</span><span class="op">=</span><span class="ident">input</span>;
        };
    }
)]
<span class="kw">struct</span> <span class="ident">CustomCoords</span> {
    <span class="ident">x</span>: <span class="ident">i8</span>,
    <span class="ident">y</span>: <span class="ident">i8</span>,
}</code></pre></div>
<p>The above example describes a report which sends X &amp; Y co-ordinates. As indicated in
the <code>#[item_settings]</code> sub-attribute, the individual inputs are described as:</p>
<ul>
<li>Datapoints (<code>data</code>) - as opposed to constant</li>
<li>Variable (<code>variable</code>) - as opposed to an array</li>
<li>Relative (<code>relative</code>) - as opposed to absolute</li>
</ul>
<h2 id="supported-struct-types" class="section-header"><a href="#supported-struct-types">Supported struct types</a></h2>
<p>The struct following the attribute must consist entirely of named fields, using
only types enumerated below, or fixed-size arrays of the types enumerated below.</p>
<ul>
<li>u8 / i8</li>
<li>u16 / i16</li>
<li>u32 / i32</li>
</ul>
<p><code>LOGICAL_MINIMUM</code> &amp; <code>LOGICAL_MAXIMUM</code> are automatically set in the descriptor, based
on the type &amp; whether <code>#[packed_bits]</code> was set on the field or not.</p>
<h2 id="descriptor-format" class="section-header"><a href="#descriptor-format">Descriptor format</a></h2>
<p>The parameters of the HID descriptor should be provided as arguments to the attribute.
The arguments should follow the basic form:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">gen_hid_descriptor</span>(
    <span class="op">&lt;</span><span class="ident">collection</span><span class="op">-</span><span class="ident">spec</span><span class="op">&gt;</span> <span class="ident">OR</span> <span class="op">&lt;</span><span class="ident">item</span><span class="op">-</span><span class="ident">spec</span><span class="op">&gt;</span>;
    <span class="op">&lt;</span><span class="ident">collection</span><span class="op">-</span><span class="ident">spec</span><span class="op">&gt;</span> <span class="ident">OR</span> <span class="op">&lt;</span><span class="ident">item</span><span class="op">-</span><span class="ident">spec</span><span class="op">&gt;</span>;
    ...
    <span class="op">&lt;</span><span class="ident">collection</span><span class="op">-</span><span class="ident">spec</span><span class="op">&gt;</span> <span class="ident">OR</span> <span class="op">&lt;</span><span class="ident">item</span><span class="op">-</span><span class="ident">spec</span><span class="op">&gt;</span>
)]</span></code></pre></div>
<h3 id="collection-spec" class="section-header"><a href="#collection-spec"><code>collection-spec</code>:</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code>    (<span class="ident">parameter</span> <span class="op">=</span> <span class="op">&lt;</span><span class="ident">constant</span> <span class="ident">or</span> <span class="number">0xxxx</span><span class="op">&gt;</span>, ...) <span class="op">=</span> {
        <span class="op">&lt;</span><span class="ident">collection</span><span class="op">-</span><span class="ident">spec</span><span class="op">&gt;</span> <span class="ident">OR</span> <span class="op">&lt;</span><span class="ident">item</span><span class="op">-</span><span class="ident">spec</span><span class="op">&gt;</span>;
        ...
    }</code></pre></div>
<p>Note: All collection specs must end in a semicolon, except the top-level one.</p>
<p>Note: Parameters are a tuple, so make sure you have a trailing comma if you only have one
parameter.</p>
<p>The valid parameters are <code>collection</code>, <code>usage_page</code>, <code>usage</code>, <code>usage_min</code>, <code>usage_max</code>, and
<code>report_id</code>. These simply configure parameters that apply to contained items in the report.
Use of the <code>collection</code> parameter automatically creates a collection feature for all items
which are contained within it, and other parameters specified in the same collection-spec
apply to the collection, not directly to the elements of the collection (ie: defining a
collection + a usage generates a descriptor where the usage is set on the collection, not the
items contained within the collection).</p>
<h3 id="item-spec" class="section-header"><a href="#item-spec"><code>item-spec</code>:</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code>    <span class="attribute">#[<span class="ident">packed_bits</span> <span class="op">&lt;</span><span class="ident">num_items</span><span class="op">&gt;</span>]</span> <span class="attribute">#[<span class="ident">item_settings</span> <span class="op">&lt;</span><span class="ident">setting</span><span class="op">&gt;</span>,...]</span> <span class="op">&lt;</span><span class="ident">fieldname</span><span class="op">&gt;</span><span class="op">=</span><span class="ident">input</span> <span class="ident">OR</span> <span class="ident">output</span>;</code></pre></div>
<p>The two sub-attributes are both optional.</p>
<ul>
<li><code>fieldname</code> refers to the name of a field within the struct. All fields must be specified.</li>
<li><code>input</code> fields are sent in reports from device to host. <code>output</code> fields are sent in reports
from host to device. This matches the terminology used in the USB &amp; HID specifications.</li>
<li><code>packed_bits</code> configures the field as a set of <code>num_items</code> booleans rather than a number.
If the number of packed bits is less than the natural bit width of the field, the
remaining most-significant bits are set as constants within the report and are not used.
<code>packed_bits</code> is typically used to implement buttons.</li>
<li><code>item_settings</code> describes settings on the input/output item, as enumerated in section
6.2.2.5 of the <a href="https://www.usb.org/sites/default/files/documents/hid1_11.pdf">HID specification, version 1.11</a>.
By default, all items are configured as <code>(Data,Var,Abs,No Wrap,Linear,Preferred State,No Null Position)</code>.</li>
</ul>
<h3 id="quirks" class="section-header"><a href="#quirks">Quirks</a></h3>
<p>By default generated descriptors are such to maximize compatibility. To change this
behaviour, you can use a <code>#[quirks &lt;settings&gt;]</code> attribute on the relevant input/output
item.
For now, the only quirk is <code>#[quirks allow_short]</code>, which allows global features to be
serialized in a 1 byte form. This is disabled by default as the Windows HID parser
considers it invalid.</p>
</div></details></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="usbd_hid" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.59.0 (9d1b2106e 2022-02-23)" ></div>
</body></html>